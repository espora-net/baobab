"use strict";const t=require("electron"),d=require("path"),f=require("fs");function u(o){const r=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(o){for(const e in o)if(e!=="default"){const n=Object.getOwnPropertyDescriptor(o,e);Object.defineProperty(r,e,n.get?n:{enumerable:!0,get:()=>o[e]})}}return r.default=o,Object.freeze(r)}const c=u(d),i=u(f),m=(o,r)=>{const e=process.platform==="darwin";return[...e?[{label:o.name,submenu:[{role:"about"},{type:"separator"},{role:"services"},{type:"separator"},{role:"hide"},{role:"hideOthers"},{role:"unhide"},{type:"separator"},{role:"quit"}]}]:[],{label:"Archivo",submenu:[{label:"Nuevo",accelerator:"CmdOrCtrl+N",click:()=>{r.webContents.send("file:new")}},{label:"Abrir",accelerator:"CmdOrCtrl+O",click:()=>{r.webContents.send("file:open")}},{type:"separator"},{label:"Guardar",accelerator:"CmdOrCtrl+S",click:()=>{r.webContents.send("file:save")}},{label:"Guardar como...",accelerator:"Shift+CmdOrCtrl+S",click:()=>{r.webContents.send("file:saveAs")}},{type:"separator"},e?{role:"close"}:{role:"quit"}]},{label:"Edición",submenu:[{role:"undo"},{role:"redo"},{type:"separator"},{role:"cut"},{role:"copy"},{role:"paste"},...e?[{role:"pasteAndMatchStyle"},{role:"delete"},{role:"selectAll"},{type:"separator"},{label:"Voz",submenu:[{role:"startSpeaking"},{role:"stopSpeaking"}]}]:[{role:"delete"},{type:"separator"},{role:"selectAll"}]]},{label:"Ver",submenu:[{role:"reload"},{role:"forceReload"},{role:"toggleDevTools"},{type:"separator"},{role:"resetZoom"},{role:"zoomIn"},{role:"zoomOut"},{type:"separator"},{role:"togglefullscreen"}]},{label:"Ventana",submenu:[{role:"minimize"},{role:"zoom"},...e?[{type:"separator"},{role:"front"},{type:"separator"},{role:"window"}]:[{role:"close"}]]},{role:"help",submenu:[{label:"Documentación",click:async()=>{const{shell:s}=require("electron");await s.openExternal("https://tiptap.dev/")}}]}]};let l=null,a=null;function p(){l=new t.BrowserWindow({width:1200,height:800,titleBarStyle:"hiddenInset",webPreferences:{preload:c.join(__dirname,"preload.js"),contextIsolation:!0,nodeIntegration:!1}}),process.env.NODE_ENV==="development"?(l.loadURL("http://localhost:3000"),l.webContents.openDevTools()):l.loadFile(c.join(__dirname,"../dist/index.html"));const o=t.Menu.buildFromTemplate(m(t.app,l));t.Menu.setApplicationMenu(o),t.ipcMain.handle("file:new",()=>{a=null,l==null||l.webContents.send("editor:clear")}),t.ipcMain.handle("file:open",async()=>{if(!l)return;const{canceled:r,filePaths:e}=await t.dialog.showOpenDialog(l,{filters:[{name:"Documentos",extensions:["txt","md","html","json"]}],properties:["openFile"]});if(!r&&e.length>0){a=e[0];const n=i.readFileSync(a,"utf-8");return{path:a,content:n}}return null}),t.ipcMain.handle("file:save",async(r,e)=>{if(!l)return!1;if(!a){const{canceled:n,filePath:s}=await t.dialog.showSaveDialog(l,{filters:[{name:"Documentos",extensions:["txt","md","html","json"]}]});if(n||!s)return!1;a=s}return i.writeFileSync(a,e,"utf-8"),!0}),t.ipcMain.handle("file:saveAs",async(r,e)=>{if(!l)return!1;const{canceled:n,filePath:s}=await t.dialog.showSaveDialog(l,{filters:[{name:"Documentos",extensions:["txt","md","html","json"]}]});return n||!s?!1:(a=s,i.writeFileSync(a,e,"utf-8"),!0)})}t.app.whenReady().then(()=>{p(),t.app.on("activate",()=>{t.BrowserWindow.getAllWindows().length===0&&p()})});t.app.on("window-all-closed",()=>{process.platform!=="darwin"&&t.app.quit()});
